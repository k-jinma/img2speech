# 画像文字認識・音声読み上げアプリ

EasyOCRとpyttsx3を使用した画像から文字を認識し、テキストを音声で読み上げるGUIアプリケーションです。日本認識に特化した最適化が施されています。

## 機能

- **高精度日本語文字認識**: EasyOCRの日本語専用モデル（japanese_g2）を使用
- **画像前処理機能**: 文字認識精度向上のための自動画像最適化
- **複数認識モード**: 前処理画像と元画像の両方で文字認識が可能
- **音声読み上げ**: pyttsx3を使用して認識されたテキストを音声で読み上げ
- **音声設定**: 読み上げ速度と音量の調整が可能
- **信頼度表示**: 各認識結果に信頼度スコアを表示
- **デバッグ機能**: 詳細な処理情報をコンソールに出力
- **ユーザーフレンドリーなGUI**: 直感的な操作が可能なインターフェース

## 必要な環境

- Python 3.7以上
- Windows 10/11（音声機能のため）
- インターネット接続（初回起動時のモデルダウンロード用）

## セットアップ手順

### 簡単インストール（推奨）

1. **配布パッケージの展開**
   - 配布ファイルを任意のフォルダに展開

2. **自動セットアップ**
   - `setup.bat` をダブルクリックして実行
   - 自動的にPython環境確認、仮想環境作成、依存関係インストールが実行されます

3. **アプリケーション起動**
   - `run.bat` をダブルクリックしてアプリケーションを起動

### 手動インストール

#### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

#### 2. アプリケーションの実行

```bash
python image_to_speech_app.py
```

### 開発者向けセットアップ

```bash
# 仮想環境の作成
python -m venv .venv

# 仮想環境のアクティベート
.venv\Scripts\activate.bat

# 依存関係のインストール
pip install -r requirements.txt

# アプリケーションの実行
python image_to_speech_app.py
```

## 使用方法

### 1. 画像の読み込み
- 「画像を選択」ボタンをクリックして、文字認識したい画像ファイルを選択
- 対応形式: PNG, JPG, JPEG, BMP, TIFF, GIF
- 画像は自動的に前処理され、文字認識用に最適化されます

### 2. 文字認識の実行

#### 前処理画像での認識（推奨）
- 「文字認識実行」ボタンをクリック
- 前処理された画像（拡大・ノイズ除去・コントラスト改善済み）を使用して認識

#### 元画像での認識
- 「元画像で認識」ボタンをクリック
- 前処理なしで元の画像から直接認識

#### 前処理画像の確認
- 「前処理画像表示」ボタンをクリック
- 文字認識に使用される前処理済み画像を確認可能

### 3. 認識結果の確認
- 認識結果は右側のテキストエリアに表示
- 各テキストに信頼度スコアが表示されます
- 信頼度が低い結果は自動的に除外されます

### 4. 音声読み上げ
- 音声設定で読み上げ速度と音量を調整
- 「音声読み上げ」ボタンをクリックしてテキストを読み上げ
- 「停止」ボタンで読み上げを停止

### 5. その他の機能
- 「テキストクリア」ボタンで認識されたテキストをクリア

## 画像前処理の詳細

アプリケーションは以下の前処理を自動的に実行します：

1. **グレースケール変換**: カラー画像を白黒に変換
2. **ノイズ除去**: Non-local Means法によるノイズ除去
3. **コントラスト改善**: CLAHE（Contrast Limited Adaptive Histogram Equalization）
4. **ガウシアンブラー**: 軽微なノイズの軽減
5. **アダプティブ二値化**: 局所的な明度に応じた二値化
6. **モルフォロジー処理**: ノイズ除去と文字の連結
7. **画像拡大**: 2倍拡大による文字の明確化

## 日本語認識の最適化

- **専用モデル**: `japanese_g2`モデルを使用
- **CPU最適化**: GPUなしでも安定動作
- **信頼度フィルタリング**: 低信頼度の結果を自動除外
- **詳細デバッグ**: 認識プロセスの詳細情報を表示

## 注意事項

- 初回起動時はEasyOCRの日本語モデルダウンロードに時間がかかります（数分程度）
- 音声機能を使用するには、システムに音声出力デバイスが必要です
- 文字認識の精度は画像の品質と文字の鮮明さに依存します
- 前処理画像での認識の方が、一般的に高い精度が得られます

## トラブルシューティング

### EasyOCRの初期化エラー
- インターネット接続を確認してください
- ファイアウォールがEasyOCRの通信をブロックしていないか確認してください
- モデルダウンロード中は時間がかかる場合があります

### 文字認識の精度が低い場合
- 「前処理画像表示」で前処理結果を確認してください
- 「元画像で認識」も試してみてください
- 画像の解像度と文字の鮮明さを確認してください

### 音声読み上げが動作しない
- システムの音声設定を確認してください
- 音声出力デバイスが正しく設定されているか確認してください

### PowerShell実行ポリシーエラー
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

## 配布ファイル構成

### 必須ファイル
- **`image_to_speech_app.py`** - メインアプリケーション
- **`requirements.txt`** - 必要なPythonライブラリ一覧
- **`setup.bat`** - 自動セットアップスクリプト
- **`run.bat`** - アプリケーション起動スクリプト
- **`README.md`** - このファイル（詳細な使用方法）
- **`INSTALL.txt`** - インストール手順の詳細

### オプションファイル
- **`DISTRIBUTION_FILES.txt`** - 配布ファイルの一覧と注意事項

### 配布不要ファイル
- **`.venv/`** - 仮想環境（ユーザー環境で自動生成）
- **`.git/`** - バージョン管理用（配布不要）
- **`models/`** - EasyOCRモデル（初回起動時に自動ダウンロード）

### 配布サイズ
- **配布パッケージ**: 約30KB
- **初回起動時のダウンロード**: 約100MB（EasyOCRモデル）

## 技術仕様

### 使用ライブラリ
- **EasyOCR 1.7.2**: 画像文字認識（日本語専用モデル対応）
- **pyttsx3 2.99**: テキスト音声変換
- **OpenCV 4.12.0**: 画像処理・前処理
- **PIL/Pillow 11.3.0**: 画像表示・変換
- **tkinter**: GUIフレームワーク
- **numpy 2.2.6**: 数値計算

### 認識精度
- 日本語テキスト: 高精度（前処理画像使用時）
- 英語テキスト: 高精度
- 信頼度閾値: 10%（前処理画像）、5%（元画像）

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 更新履歴

### v2.1.0
- 配布用ファイルの追加
- 自動セットアップスクリプト（setup.bat）の実装
- アプリケーション起動スクリプト（run.bat）の実装
- インストール手順の詳細化（INSTALL.txt）
- 配布ファイル構成の整理

### v2.0.0
- 日本語認識の大幅な精度向上
- 画像前処理機能の追加
- 複数認識モードの実装
- デバッグ機能の強化
- 信頼度表示機能の追加 